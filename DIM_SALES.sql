CREATE  TABLE BMW_DEALERS (
    DEALER_ID        NUMBER PRIMARY KEY,
    DEALER_CODE      VARCHAR2(20) UNIQUE NOT NULL,
    DEALER_NAME      VARCHAR2(100) NOT NULL,
    REGION           VARCHAR2(50),
    COUNTRY          VARCHAR2(50)
);

CREATE   TABLE BMW_MODELS (
    MODEL_ID         NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    MODEL_CODE       VARCHAR2(20) UNIQUE NOT NULL,
    BRAND            VARCHAR2(20) CHECK (BRAND IN ('BMW', 'MINI')),
    MODEL_NAME       VARCHAR2(100) NOT NULL,
    TRIM             VARCHAR2(50),
    SEGMENT          VARCHAR2(50)
);

CREATE   TABLE BMW_SALES_CALENDAR (
    CALENDAR_ID      NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DATE_VALUE       DATE UNIQUE NOT NULL,
    YEAR_NUM         NUMBER,
    MONTH_NUM        NUMBER,
    MONTH_NAME       VARCHAR2(20),
    BLACKOUT_FLAG    CHAR(1) DEFAULT 'N' CHECK (BLACKOUT_FLAG IN ('Y', 'N'))
);

-- Seed core dealer dimension rows. Explicit IDs avoid sequence requirements for empty tables.
INSERT INTO BMW_DEALERS (DEALER_ID, DEALER_CODE, DEALER_NAME, REGION, COUNTRY)
SELECT 1, 'D005', 'Sunbelt Motors', 'South', 'USA' FROM dual
WHERE NOT EXISTS (SELECT 1 FROM BMW_DEALERS WHERE DEALER_CODE = 'D005');

INSERT INTO BMW_DEALERS (DEALER_ID, DEALER_CODE, DEALER_NAME, REGION, COUNTRY)
SELECT 2, 'D008', 'Pacific BMW', 'West', 'USA' FROM dual
WHERE NOT EXISTS (SELECT 1 FROM BMW_DEALERS WHERE DEALER_CODE = 'D008');

INSERT INTO BMW_DEALERS (DEALER_ID, DEALER_CODE, DEALER_NAME, REGION, COUNTRY)
SELECT 3, 'D007', 'Canyon Cars', 'West', 'USA' FROM dual
WHERE NOT EXISTS (SELECT 1 FROM BMW_DEALERS WHERE DEALER_CODE = 'D007');

INSERT INTO BMW_DEALERS (DEALER_ID, DEALER_CODE, DEALER_NAME, REGION, COUNTRY)
SELECT 4, 'D001', 'Parkway BMW', 'Northeast', 'USA' FROM dual
WHERE NOT EXISTS (SELECT 1 FROM BMW_DEALERS WHERE DEALER_CODE = 'D001');

-- Seed BMW/MINI model rows (MODEL_ID uses the identity column default).
INSERT INTO BMW_MODELS (BRAND, MODEL_NAME, TRIM, MODEL_CODE, SEGMENT)
SELECT 'MINI', 'Countryman', 'S ALL4', 'MINI-Ctrymn-S4', 'Crossover' FROM dual
WHERE NOT EXISTS (SELECT 1 FROM BMW_MODELS WHERE MODEL_CODE = 'MINI-Ctrymn-S4');

INSERT INTO BMW_MODELS (BRAND, MODEL_NAME, TRIM, MODEL_CODE, SEGMENT)
SELECT 'BMW', 'X3', 'xDrive30i', 'BMW-X3-30i', 'SUV' FROM dual
WHERE NOT EXISTS (SELECT 1 FROM BMW_MODELS WHERE MODEL_CODE = 'BMW-X3-30i');

INSERT INTO BMW_MODELS (BRAND, MODEL_NAME, TRIM, MODEL_CODE, SEGMENT)
SELECT 'BMW', '3 Series', '330i', 'BMW-330i', 'Sedan' FROM dual
WHERE NOT EXISTS (SELECT 1 FROM BMW_MODELS WHERE MODEL_CODE = 'BMW-330i');

-- Populate the sales calendar once; skip dates already present if the script is rerun.
DECLARE
    v_start_date DATE := DATE '2010-01-01';
    v_end_date   DATE := DATE '2035-12-31';
BEGIN
    FOR d IN (
        SELECT v_start_date + LEVEL - 1 AS dt
        FROM dual
        CONNECT BY v_start_date + LEVEL - 1 <= v_end_date
    )
    LOOP
        INSERT INTO BMW_SALES_CALENDAR
            (DATE_VALUE, YEAR_NUM, MONTH_NUM, MONTH_NAME, BLACKOUT_FLAG)
        SELECT
            d.dt,
            EXTRACT(YEAR FROM d.dt),
            EXTRACT(MONTH FROM d.dt),
            TO_CHAR(d.dt, 'Month'),
            'N'
        FROM dual
        WHERE NOT EXISTS (
            SELECT 1
            FROM BMW_SALES_CALENDAR c
            WHERE c.DATE_VALUE = d.dt
        );
    END LOOP;
END;
/











